<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iPalWebsite2.0</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css"> </head>
<body class="login-page">
    <header class="header">
        <a href="index.html" class="logo-link">
            <img src="ipalRobot_image.jpg" alt="iPal Robot Trainer Logo" class="header-logo">
        </a>
        <h1 class="header-text"><i class="fas fa-bolt"></i> RoboFit ROBOT TRAINER <i class="fas fa-bolt"></i></h1>
        <nav>
            <button id="menu-toggle" aria-label="Open navigation">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul class="menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </nav>
    </header>

    <section class="intro-section">

        <h2>Train Smarter. Track Stronger. Achieve More with RoboFit.</h2>
        <p>
            Welcome to the future of personalized fitness! RoboFit combines a dedicated robot coach
            with seamless online progress tracking. Here’s how you’ll transform your routine:
        </p>
    
        <ul>
            <li class="icon-robot">
                <i class="fas fa-robot"></i>Interactive Guidance: Follow RoboFit’s visual demos for Yoga, Calisthenics & Cardio.
            </li>
            <li class="icon-sync">
                <i class="fas fa-sync-alt"></i>Synced Progress: Your completed workouts automatically appear on your web dashboard.
            </li>
            <li class="icon-calendar">
                <i class="fas fa-calendar-alt"></i>Visualize Your Journey: See your activity history and consistency on your personal calendar.
            </li>
            <li class="icon-trophy">
                <i class="fas fa-trophy"></i>Earn Trophies: Stay motivated by earning Trophies!
            </li>
            <li class="icon-cogs">
                <i class="fas fa-cogs"></i>Your Fitness Command Center: Login via our Website or with the RoboFit console.
            </li>
        </ul>
    
    </section>
    

    <main>
        <div class="main-content">
            <section class="logo-section">
                <div class="sticky-logo-wrapper"> <img src="ipalRobot_image.jpg" alt="iPal Robot Trainer Logo" class="circle-image">
                </div>                  </section>

            <section class="login-section"> <form class="login-form" id="login-form" action="calendar.html" method="get">
                    <h2>Login</h2>
                    <div class="form-group">
                        <label for="username">Username:</label>
                        <input type="text" id="username" name="username" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password:</label>
                        <input type="password" id="password" name="password" required>
                    </div>
                    <button type="submit">Login</button>
                    <p id="login-error-message" class="error-message"></p>
                    <p class="register-link">Not registered? <a href="#" id="register-link">Click here</a></p>
                </form>
            </section>

            <div id="registration-form" style="display: none;" class="about-page"> <section class="about-content">
                    <h1>Create Your Account</h1>
                    <p>Join our fitness community and start your journey with iPal Robot Trainer today!</p>


                    <h4>Register</h4>
                    <form id="register-form">
                        <label for="reg-email">Email:</label><br>
                        <input type="email" id="reg-email" name="email" required><br><br>
                        <label for="reg-username">Username:</label><br>
                        <input type="text" id="reg-username" name="username" required><br><br>
                        <label for="reg-password">Password:</label><br>
                        <input type="password" id="reg-password" name="password" required><br><br>
                        <label for="reg-first-name">First Name:</label><br>
                        <input type="text" id="reg-first-name" name="first_name" required><br><br>
                        <label for="reg-last-name">Last Name:</label><br>
                        <input type="text" id="reg-last-name" name="last_name" required><br><br>
                        <label for="reg-gender">Gender:</label><br>
                        <select id="reg-gender" name="gender" required>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                        </select><br><br>
                        <label for="reg-curr-weight">Current Weight:</label><br>
                        <input type="number" id="reg-curr-weight" name="curr_weight" step="0.1" required><br><br>
                        <label for="reg-height-inches">Height (in inches):</label><br>
                        <input type="number" id="reg-height-inches" name="height_inches" required><br><br>
                        <label for="reg-goal-weight">Goal Weight:</label><br>
                        <input type="number" id="reg-goal-weight" name="goal_weight" step="0.1" required><br><br>
                        <label for="reg-dob">Date of Birth:</label><br>
                        <input type="date" id="reg-dob" name="date_of_birth" required><br><br>
                        <input type="submit" value="Register" class="button-gradient">
                    </form>
                    <p>Already registered? <a href="#" id="login-link">Click here to sign in</a></p>
                </section>
            </div>

            <div class="scrolling-text-container">
                <div role="marquee" aria-label="Scrolling announcement">
                    <span class="scrolling-text">01010101 DANCE ROBOT 0101010 &nbsp;&nbsp;&nbsp; 01010101 DANCE ROBOT 0101010 &nbsp;&nbsp;&nbsp; 01010101 DANCE ROBOT 0101010 &nbsp;&nbsp;&nbsp; 01010101 DANCE ROBOT 0101010</span>
                </div>
            </div>

            <div id="homepage-videos">
                 <div class="video-box">
                    <p class="video-caption">
                        Master Yoga poses with RoboFit's visual guidance. Stay motivated as every completed session is saved to your profile!
                    </p>
                    <video controls playsinline>
                        <source src="awyZvpQ_460svvp9.webm" type="video/webm">
                    </video>
                </div>
                <div class="video-box">
                    <p class="video-caption">
                        Get your heart pumping and crush your goals! RoboFit tracks every Cardio session, syncs your results, and keeps you motivated by showing your progress.
                    </p>
                    <video controls playsinline>
                        <source src="aZDeQvn_460svvp9.webm" type="video/webm">
                    </video>
                </div>
                <div class="video-box">
                    <p class="video-caption">
                        Build strength move by move! RoboFit guides your form as you master bodyweight training, and motivates you with trophies.
                    </p>
                    <video controls playsinline>
                        <source src="armzygB_460svvp9.webm" type="video/webm">
                    </video>
                </div>
            </div>

        </div>
    </main>

    <footer class="footer">
        <div id="color-mode-switch" aria-hidden="true">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707-.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
            <input type="checkbox" id="switch" aria-label="Toggle Dark Mode">
            <label class="switch-icon" for="switch">Dark Mode Toggle</label>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
            </svg>
        </div>
    </footer>

    <script src="script.js"></script> <script>
       // --- Get references to elements ONCE ---
// --- Get references to elements ONCE ---
const loginSection = document.querySelector('.login-section');
const registrationFormDiv = document.getElementById('registration-form');
const homepageVideos = document.getElementById('homepage-videos');
const logoWrapper = document.querySelector('.sticky-logo-wrapper'); // Keep if used elsewhere, otherwise optional here
const registerLink = document.getElementById('register-link');
const loginLink = document.getElementById('login-link');
const registerFormSubmit = document.getElementById('register-form'); // The actual form element
const loginFormSubmit = document.getElementById('login-form'); // The login form element
const introSection = document.querySelector('.intro-section'); // Get the intro section

// --- Elements for Feedback Messages (Ensure these IDs exist in your HTML) ---
const registerSuccessMsg = document.getElementById('register-success-message');
const registerErrorMsg = document.getElementById('register-error-message');
const loginErrorMsgElem = document.getElementById('login-error-message');

// --- View Switching Logic ---
// Check if ALL necessary elements exist before adding listeners
if (registerLink && loginLink && loginSection && registrationFormDiv && introSection) { // Removed homepageVideos check as it might not always be present/needed for switching

    // --- Register Link Click (Show Registration) ---
    registerLink.addEventListener('click', function(event) {
        event.preventDefault();
        introSection.style.display = 'none'; // <<< HIDE Intro Section
        loginSection.style.display = 'none';
        registrationFormDiv.style.display = 'block';
        if(homepageVideos) homepageVideos.style.display = 'none'; // Hide videos (check if exists first)

        // Clear any previous messages
        if(registerSuccessMsg) registerSuccessMsg.style.display = 'none';
        if(registerErrorMsg) registerErrorMsg.style.display = 'none';
        if (loginErrorMsgElem) loginErrorMsgElem.textContent = '';
    });

    // --- Login Link Click (Show Login) ---
    loginLink.addEventListener('click', function(event) {
        event.preventDefault();
        introSection.style.display = 'none'; // <<< KEEP Intro Section hidden (or set to 'block'/'flex' etc. if you want it back)
        registrationFormDiv.style.display = 'none';
        loginSection.style.display = 'flex'; // Assuming flex is the correct display type for login section
        if(homepageVideos) homepageVideos.style.display = 'block'; // Show videos (check if exists first)

        // Clear any previous messages
        if(registerSuccessMsg) registerSuccessMsg.style.display = 'none';
        if(registerErrorMsg) registerErrorMsg.style.display = 'none';
        if (loginErrorMsgElem) loginErrorMsgElem.textContent = '';
    });

} else {
    console.warn("One or more elements needed for view switching not found (Login/Register links, forms, intro section).");
}


// --- Registration Form Submission ---
if (registerFormSubmit) {
    registerFormSubmit.addEventListener('submit', function(event) {
        event.preventDefault();

        // Clear previous messages
        if(registerSuccessMsg) registerSuccessMsg.style.display = 'none';
        if(registerErrorMsg) registerErrorMsg.style.display = 'none';

        // --- Form data collection ---
        const email = document.getElementById('reg-email').value.trim();
        const username = document.getElementById('reg-username').value.trim();
        const password = document.getElementById('reg-password').value;
        const firstName = document.getElementById('reg-first-name').value.trim();
        const lastName = document.getElementById('reg-last-name').value.trim();
        const gender = document.getElementById('reg-gender').value;
        const currWeight = parseFloat(document.getElementById('reg-curr-weight').value);
        const heightInches = parseInt(document.getElementById('reg-height-inches').value);
        const goalWeight = parseFloat(document.getElementById('reg-goal-weight').value);
        const dateOfBirth = document.getElementById('reg-dob').value;
        // --- End form data collection ---

        // Basic validation example
        if (!email || !username || !password || !firstName || !lastName || !gender || isNaN(currWeight) || isNaN(heightInches) || isNaN(goalWeight) || !dateOfBirth) {
             if(registerErrorMsg) {
                registerErrorMsg.textContent = 'Please fill in all required fields.';
                registerErrorMsg.style.display = 'block';
            } else { console.error("Register error message element not found."); }
            return; // Stop submission
        }

        // --- Fetch call for Registration (Using ABSOLUTE Path) ---
        fetch('http://18.212.50.45:3000/api/register', { // <<< CORRECTED URL
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                email, username, password,
                first_name: firstName, last_name: lastName, gender,
                curr_weight: currWeight, height_inches: heightInches,
                goal_weight: goalWeight, date_of_birth: dateOfBirth
            })
        })
        .then(response => {
             if (!response.ok) {
                // Try to get error message from backend response body
                return response.json().then(errData => {
                    throw new Error(errData.message || `Registration failed: ${response.statusText || response.status}`);
                }).catch(() => {
                    // Fallback if response not JSON or .json() fails
                    throw new Error(`Registration failed: ${response.statusText || response.status}`);
                });
             }
             return response.json();
        })
        .then(data => {
            if (data.success) {
                if(registerSuccessMsg) { // Use text feedback instead of alert
                    registerSuccessMsg.textContent = 'Registration successful! Redirecting to login...';
                    registerSuccessMsg.style.display = 'block';
                    if(registerErrorMsg) registerErrorMsg.style.display = 'none'; // Hide error msg on success
                } else { console.log("Registration successful!"); } // Fallback log

                registerFormSubmit.reset(); // Clear form

                // Switch back to login view after delay
                setTimeout(() => {
                    if(registrationFormDiv) registrationFormDiv.style.display = 'none';
                    if(loginSection) loginSection.style.display = 'flex';
                    if(homepageVideos) homepageVideos.style.display = 'block';
                    if(registerSuccessMsg) registerSuccessMsg.style.display = 'none'; // Hide message after switching
                    if(introSection) introSection.style.display = 'none'; // Keep intro hidden
                }, 2000);

            } else {
                 if(registerErrorMsg) { // Use text feedback instead of alert
                    registerErrorMsg.textContent = 'Registration failed: ' + (data.message || 'Unknown error');
                    registerErrorMsg.style.display = 'block';
                    if(registerSuccessMsg) registerSuccessMsg.style.display = 'none'; // Hide success msg on error
                } else { console.error('Registration failed:', data.message || 'Unknown error'); }
            }
        })
        .catch(error => {
            console.error('Registration Fetch Error:', error);
            if(registerErrorMsg) {
                registerErrorMsg.textContent = error.message || 'An error occurred during registration. Check connection or server logs.';
                registerErrorMsg.style.display = 'block';
                 if(registerSuccessMsg) registerSuccessMsg.style.display = 'none';
            } else { console.error('An error occurred during registration.'); }
        });
    });
} else {
     console.warn("Registration form element not found.");
}

// --- Login Form Submission ---
if (loginFormSubmit) {
    loginFormSubmit.addEventListener('submit', function (e) {
        e.preventDefault();

        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        // loginErrorMsgElem defined above

        // Clear previous error message
        if (loginErrorMsgElem) loginErrorMsgElem.textContent = '';

        // Check if inputs exist before getting value
        if (!usernameInput || !passwordInput) {
             console.error("Username or password input element not found.");
             if (loginErrorMsgElem) loginErrorMsgElem.textContent = 'Login form error. Please refresh.';
             return;
        }

        const username = usernameInput.value.trim();
        const password = passwordInput.value;

        // Basic validation
         if (!username || !password) {
            if (loginErrorMsgElem) loginErrorMsgElem.textContent = 'Please enter both username and password.';
            return; // Stop submission
        }

        // --- Fetch call for Signin (Using ABSOLUTE Path) ---
        fetch('http://18.212.50.45:3000/api/signin', { // <<< CORRECTED URL
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ username, password })
        })
        .then(response => {
             if (!response.ok) {
                 // Try to get error message from backend response body
                return response.json().then(errData => {
                    throw new Error(errData.message || `Login failed: ${response.statusText || response.status}`);
                }).catch(() => {
                     // Fallback if response not JSON or .json() fails
                    throw new Error(`Login failed: ${response.statusText || response.status}`);
                });
             }
             return response.json();
        })
        .then(data => {
            if (data.success) {
                // Successful login - redirect
                window.location.href = 'calendar.html';
            } else {
                 // Handle backend indicating failure (e.g. Invalid credentials)
                 if (loginErrorMsgElem) {
                    loginErrorMsgElem.textContent = data.message || 'Invalid credentials.';
                } else { console.error("Login failed:", data.message || 'Invalid credentials.'); }
            }
        })
        .catch(error => {
            console.error('Login Fetch Error:', error);
            if (loginErrorMsgElem) {
                loginErrorMsgElem.textContent = error.message || 'An error occurred during login. Check connection or server logs.';
            } else { console.error('An error occurred during login.'); }
        });
    });
} else {
    console.warn("Login form element not found.");
}


// --- Initial setup: Ensure videos are visible if login form is initially shown ---
// This depends on your default HTML state (which form is shown initially?)
// Assuming login form is shown by default:
if (loginSection && window.getComputedStyle(loginSection).display !== 'none') {
    if(homepageVideos) homepageVideos.style.display = 'block';
    // Ensure intro is visible if login is default view
    // if(introSection) introSection.style.display = 'block'; // Or 'flex', etc. - uncomment if needed
} else if (registrationFormDiv && window.getComputedStyle(registrationFormDiv).display !== 'none') {
    // If registration form is shown by default instead
    if(homepageVideos) homepageVideos.style.display = 'none';
    if(introSection) introSection.style.display = 'none'; // Intro should be hidden if starting on registration
} else {
    // Fallback if neither is explicitly shown (e.g., hide videos)
     if(homepageVideos) homepageVideos.style.display = 'none';
     // Decide initial state for intro section if neither form is visible
     // if(introSection) introSection.style.display = 'block';
}
    </script>

<!-- NEW: ADDED MOUSE-FOLLOW SCRIPT (NON-INTRUSIVE) -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- Get Elements ---
        const logoWrapper = document.querySelector('.sticky-logo-wrapper');
        const registerLink = document.getElementById('register-link');
        const loginLink = document.getElementById('login-link');
        // Elements needed for bounds
        const headerElement = document.querySelector('.header'); 
        const footerElement = document.querySelector('.footer'); 

        // --- Configuration ---
        const DESKTOP_BREAKPOINT = 769; // Min width for effect
        const VERTICAL_GAP = 15;       // Gap from header/footer
        const ACTIVE_CLASS = 'js-mouse-follow-active'; // CSS class name

        // --- Check Core Elements ---
        if (!logoWrapper || !registerLink || !loginLink || !headerElement || !footerElement) {
            console.warn("Mouse follow script: Required elements missing. Effect disabled.");
            return; 
        }

        // --- State Variables ---
        let isMouseFollowing = false;
        let animationId = null;
        let mouseY = window.innerHeight / 2;
        let isDesktop = window.innerWidth >= DESKTOP_BREAKPOINT;

        // --- Core Update Function ---
        function updateLogoPosition() {
            // Stop loop if inactive or not desktop
            if (!isMouseFollowing || !isDesktop) {
                if (isMouseFollowing) stopMouseFollow(); // Clean up if deactivated unexpectedly
                return;
            }

            const logoHeight = logoWrapper.offsetHeight;
            const viewportHeight = window.innerHeight;
            const headerHeight = headerElement.offsetHeight;
            const footerHeight = footerElement.offsetHeight;

            if (logoHeight <= 0) { // Check height
                 console.warn("Mouse Follow: logo height is 0.");
                 animationId = requestAnimationFrame(updateLogoPosition); // Keep trying
                 return;
            }

            // Calculate Boundaries respecting header/footer
            const minY = headerHeight + VERTICAL_GAP;
            const maxY = viewportHeight - footerHeight - logoHeight - VERTICAL_GAP;
            const effectiveMaxY = Math.max(minY, maxY); 

            // Target Y to center image on cursor
            const targetY = mouseY - logoHeight / 2; 
            
            // Clamp position within calculated boundaries
            const clampedY = Math.max(minY, Math.min(targetY, effectiveMaxY)); 
            
            // Apply ONLY the vertical transform
            logoWrapper.style.transform = `translateY(${clampedY}px)`;
            
            // Continue the loop
            animationId = requestAnimationFrame(updateLogoPosition);
        }

        // --- Mouse Move Handler ---
        function handleMouseMove(e) {
             if (!isMouseFollowing || !isDesktop) return; 
             mouseY = e.clientY; 
        }

        // --- Activate Function ---
        function startMouseFollow() {
            isDesktop = window.innerWidth >= DESKTOP_BREAKPOINT; 
            if (isMouseFollowing || !isDesktop) {
                console.log("Mouse follow not activated (already active or not desktop).");
                return; 
            }
            
            console.log("Starting mouse follow");
            isMouseFollowing = true;
             // Use RAF to ensure layout is stable before getting height/pos
            requestAnimationFrame(() => {
                // Set initial Y position based on current mouse (or center)
                mouseY = mouseY || window.innerHeight / 2;
                const initialLogoHeight = logoWrapper.offsetHeight;
                const initialHeaderHeight = headerElement.offsetHeight;
                const initialFooterHeight = footerElement.offsetHeight;
                const initialMinY = initialHeaderHeight + VERTICAL_GAP;
                const initialMaxY = window.innerHeight - initialFooterHeight - initialLogoHeight - VERTICAL_GAP;
                const initialEffectiveMaxY = Math.max(initialMinY, initialMaxY);
                const initialTargetY = mouseY - initialLogoHeight / 2;
                const initialClampedY = Math.max(initialMinY, Math.min(initialTargetY, initialEffectiveMaxY));
                
                logoWrapper.style.transform = `translateY(${initialClampedY}px)`; // Apply initial Y
                logoWrapper.classList.add(ACTIVE_CLASS); // Add class AFTER setting initial transform
                
                window.addEventListener('mousemove', handleMouseMove, { passive: true }); // Attach listener
                
                // Start RAF loop
                if (animationId) cancelAnimationFrame(animationId);
                animationId = requestAnimationFrame(updateLogoPosition);
            });
        }

        // --- Deactivate Function ---
        function stopMouseFollow() {
            if (!isMouseFollowing) return;
            console.log("Stopping mouse follow");
            isMouseFollowing = false;
            logoWrapper.classList.remove(ACTIVE_CLASS); 
            // Use RAF to ensure class removal applies before resetting transform
            requestAnimationFrame(() => {
                logoWrapper.style.transform = 'none'; // Reset position
            });
            window.removeEventListener('mousemove', handleMouseMove); // <<< Corrected removal target
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null; 
            }
        }

        // --- Resize Listener ---
        let resizeTimeout;
        function handleResize() {
             clearTimeout(resizeTimeout);
             resizeTimeout = setTimeout(() => {
                 const wasDesktop = isDesktop;
                 isDesktop = window.innerWidth >= DESKTOP_BREAKPOINT;
                 if (wasDesktop && !isDesktop && isMouseFollowing) {
                     console.log("Screen resized below breakpoint, stopping follow.");
                     stopMouseFollow();
                 }
                 // Optional: Add logic here to re-start if window becomes desktop *and* section 2 is still visible
                 // else if (!wasDesktop && isDesktop) { ... check section 2 display ... startMouseFollow(); }
             }, 150); 
        }
        window.addEventListener('resize', handleResize);

        // --- Toggle on register/login clicks ---
        registerLink.addEventListener('click', startMouseFollow);
        loginLink.addEventListener('click', stopMouseFollow);

        // --- Initial state check ---
        const registrationFormDiv = document.getElementById('registration-form');
        if (registrationFormDiv && window.getComputedStyle(registrationFormDiv).display !== 'none') {
            startMouseFollow(); // Activate if registration form visible on load
        } else {
           stopMouseFollow(); // Ensure inactive initially
        }

    });
</script>
    </body>
</html>